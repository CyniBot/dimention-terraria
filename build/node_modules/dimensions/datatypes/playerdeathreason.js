"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
const bufferwriter_1 = require("dimensions/packets/bufferwriter");
const bitsbyte_1 = require("./bitsbyte");
const utils_1 = require("dimensions/utils");
class PlayerDeathReason {
    constructor(reader) {
        this._reasonType = null;
        this._killerPlayerId = null;
        this._killingNpcIndex = null;
        this._projectileIndex = null;
        this._typeOfDeath = null;
        this._projectileType = null;
        this._itemType = null;
        this._itemPrefix = null;
        this._deathReason = null;
        this.processDeathReason(reader);
    }
    get deathReason() {
        return this._deathReason || " was killed";
    }
    get byteLen() {
        let len = 1;
        if (this._killerPlayerId !== null) {
            len += 2;
        }
        if (this._killingNpcIndex !== null) {
            len += 2;
        }
        if (this._projectileIndex !== null) {
            len += 2;
        }
        if (this._reasonType !== null && this._reasonType[3]) {
            len += 1;
        }
        if (this._projectileType !== null) {
            len += 2;
        }
        if (this._itemType !== null) {
            len += 2;
        }
        if (this._itemPrefix !== null) {
            len += 1;
        }
        if (this._deathReason !== null) {
            len += (0, utils_1.getPackedStringByteLen)(this._deathReason);
        }
        return len;
    }
    getHexData() {
        let writer = new bufferwriter_1.default(this.byteLen);
        writer.packByte(this._reasonType !== null ? this._reasonType.value : 0);
        if (this._killerPlayerId !== null) {
            writer.packInt16(this._killerPlayerId);
        }
        if (this._killingNpcIndex !== null) {
            writer.packInt16(this._killingNpcIndex);
        }
        if (this._projectileIndex !== null) {
            writer.packInt16(this._projectileIndex);
        }
        if (this._reasonType !== null && this._reasonType[3]) {
            writer.packByte(this._typeOfDeath !== null ? this._typeOfDeath.value : 0);
        }
        if (this._projectileType !== null) {
            writer.packInt16(this._projectileType);
        }
        if (this._itemType !== null) {
            writer.packInt16(this._itemType);
        }
        if (this._itemPrefix !== null) {
            writer.packByte(this._itemPrefix);
        }
        if (this._deathReason !== null) {
            writer.packString(this._deathReason);
        }
        return writer.data;
    }
    processDeathReason(reader) {
        this._reasonType = new bitsbyte_1.default(reader.readByte());
        if (this._reasonType[0]) {
            this._killerPlayerId = reader.readInt16();
        }
        if (this._reasonType[1]) {
            this._killingNpcIndex = reader.readInt16();
        }
        if (this._reasonType[2]) {
            this._projectileIndex = reader.readInt16();
        }
        if (this._reasonType[3]) {
            this._typeOfDeath = new bitsbyte_1.default(reader.readByte());
        }
        if (this._reasonType[4]) {
            this._projectileType = reader.readInt16();
        }
        if (this._reasonType[5]) {
            this._itemType = reader.readInt16();
        }
        if (this._reasonType[6]) {
            this._itemPrefix = reader.readByte();
        }
        if (this._reasonType[7]) {
            this._deathReason = reader.readString();
        }
    }
}
exports.default = PlayerDeathReason;
